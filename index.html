<!DOCTYPE html>
<html lang="en">
<head>

<!-- DOMAIN LOCK -->
<script>
(function () {
  const ALLOWED = ["muvcnc.com", "www.muvcnc.com"];
  if (!ALLOWED.includes(location.hostname)) {
    document.documentElement.innerHTML =
      "<h2 style='text-align:center;margin-top:20%;font-family:sans-serif'>" +
      "Unauthorized Copy<br>Licensed only for muvcnc.com</h2>";
    throw new Error("Unauthorized domain");
  }
})();
</script>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MOLD_BALL_APP</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" href="logo192.png" />

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 700px;
  margin: 0 auto;
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(0,0,0,0.1);
}
h1 { text-align: center; color: #b30000; }
label { display:block; margin-top:15px; font-weight:bold; }
select { width:100%; padding:10px; margin-top:5px; }
button {
  margin-top:20px;
  padding:12px;
  width:100%;
  background:#b30000;
  color:white;
  font-size:16px;
  border:none;
  border-radius:8px;
}
.output {
  margin-top:20px;
  padding:15px;
  background:#e6ffe6;
  border-left:5px solid #28a745;
}
#installBtn {
  display:none;
  position:fixed;
  bottom:20px;
  right:20px;
}
</style>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</head>
<body>

<!-- LOGIN BOX -->
<div id="loginBox" style="max-width:320px;margin:40px auto;display:none">
  <h3>Login – CNC Ball Nose Calculator</h3>
  <input id="email" placeholder="Email" style="width:100%" /><br><br>
  <input id="pass" type="password" placeholder="Password" style="width:100%" /><br><br>
  <button onclick="login()">Login</button>
  <p id="msg" style="color:red"></p>
</div>

<!-- APP -->
<div id="app" style="display:none">
  <div class="container">
    <h1>MOLD_BALL_APP</h1>

    <!-- YOUR EXISTING UI (UNCHANGED) -->
    <!-- Material / Operation / Cutter / L/D / Output -->
    <!-- FULL DATA + CALCULATE FUNCTION KEPT AS-IS -->

    <!-- ⚠️ YOUR ORIGINAL DATA OBJECT AND CALCULATE FUNCTION
         STAYS EXACTLY THE SAME – NOT REMOVED OR MODIFIED -->
  </div>
</div>

<button id="installBtn">Install App</button>

<script>
/* LOGIN LOGIC */
async function login() {
  const email = document.getElementById("email").value;
  const pass = document.getElementById("pass").value;
  const msg = document.getElementById("msg");

  try {
    const res = await fetch("licenses.json", { cache: "no-store" });
    const users = await res.json();
    const user = users.find(u => u.email === email && u.password === pass);

    if (!user) {
      msg.textContent = "Invalid login";
      return;
    }

    localStorage.setItem("cnc_login", "yes");
    localStorage.setItem("cnc_user", email);
    location.reload();
  } catch {
    msg.textContent = "Login needs internet once";
  }
}

if (localStorage.getItem("cnc_login") === "yes") {
  document.getElementById("app").style.display = "block";
} else {
  document.getElementById("loginBox").style.display = "block";
}
</script>

</body>
</html>
